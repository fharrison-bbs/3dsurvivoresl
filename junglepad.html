// Add these variables to your GAME STATE section
const pets = [];
const PET_TYPES = [
    { name: 'Wisp', color: 0x00ffff, glow: 1.5 },
    { name: 'Phoenix Spirit', color: 0xff6600, glow: 1.2 },
    { name: 'Forest Sprite', color: 0x88ff00, glow: 1.0 }
];

// Add this function after createEnemy
function createPet() {
    const type = PET_TYPES[Math.floor(Math.random() * PET_TYPES.length)];
    const petGroup = new THREE.Group();

    // Pet Core
    const core = new THREE.Mesh(
        new THREE.SphereGeometry(0.2, 16, 16),
        new THREE.MeshStandardMaterial({
            color: type.color,
            emissive: type.color,
            emissiveIntensity: type.glow,
            transparent: true,
            opacity: 0.8
        })
    );
    petGroup.add(core);

    // Orbiting Rings
    const ring = new THREE.Mesh(
        new THREE.TorusGeometry(0.35, 0.02, 16, 32),
        new THREE.MeshStandardMaterial({ color: type.color, emissive: type.color })
    );
    ring.rotation.x = Math.PI / 2;
    petGroup.add(ring);

    // Pet Light
    const petLight = new THREE.PointLight(type.color, 1, 5);
    petGroup.add(petLight);

    scene.add(petGroup);
    
    pets.push({
        mesh: petGroup,
        ring: ring,
        light: petLight,
        offset: new THREE.Vector3(1.5, 0.5, 2), // Position relative to camera
        floatY: 0
    });
}

// Add this to your animate() function loop
function updatePets() {
    pets.forEach(pet => {
        // Calculate target position (behind and to the side of the camera)
        const targetPos = new THREE.Vector3().copy(camera.position);
        const sideOffset = new THREE.Vector3(1, 0.5, 1.5).applyQuaternion(camera.quaternion);
        targetPos.add(sideOffset);

        // Smoothly move pet toward target
        pet.mesh.position.lerp(targetPos, 0.05);

        // Floating animation
        pet.floatY += 0.05;
        pet.mesh.position.y += Math.sin(pet.floatY) * 0.01;

        // Rotate the ring
        pet.ring.rotation.z += 0.05;
        pet.ring.rotation.x += 0.02;

        // Pulse the light
        pet.light.intensity = 1 + Math.sin(pet.floatY) * 0.5;
    });
}

// Call createPet() once at the bottom of your script
createPet();
